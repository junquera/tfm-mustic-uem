\chapter{Solución propuesta}

Para analizar las librerías he elaborado un sistema de posicionamiento anónimo en función de la temperatura y el mes del año.

En este sistema habrá tres actores: el cliente, el servidor de posicionamiento (programado con SEAL) y un tercer servidor (programado con TFHE) que generará el modelo para calcular la posición.

El cliente consultará su posición con el servidor de SEAL, que previamente habrá generado en el servidor de TFHE un modelo de posicionamiento basado en las temperaturas del último año.

Se han elegido tanto el sistema de ejemplo como las tecnologías específicas para cada uno de los actores en función de las capacidades y limitaciones de cada tecnología. Como resultado del proyecto se ha creado, además del análisis y el propio código del proyecto, una librería de operaciones matemáticas implementadas en TFHE\cite{tfhe-math} con puertas lógicas, que es innovadora en tanto en cuanto no existe ningún código público que permita trabajar con TFHE a este nivel.

% TODO NO debe ser publico el descifrado porque es vulnerable a CCA

\section{Funcionamiento del sistema}

% TODO Gráficos de curvas de regresión con ejemplos

\subsection{Generación del modelo}

1. El cliente genera un par de claves

2. Cifra n pares de datos (en nuestro ejemplo el par sería (mes, temperatura)).

3. Sube los datos cifrados y su clave pública. El número de datos que se puede subir está limitado por el crecimiento del tamaño (en bits) de dichos datos al exponenciarlos para calcular la curva de regresión. Trabajaremos con los datos de 12 meses porque, como comentaremos más adelante, aunque el orden máximo al que llegaríamos con estos datos es de 46 bits tendremos otras limitaciones a la hora de procesar los datos.

4. EL servidor procesa los datos

\subsection{Obtención de la posición}


\section{Implementación con TFHE}

Para generar la curva de regresión que utilizará el servidor de SEAL para ubicar al usuario, dicho servidor cifrará los datos de temperatura del último año en dos ubicaciones distintas y se las enviará al servidor TFHE. Este procesa los datos cifrados y calcula la regresión cuadrática codificada en tres parámetros $a, b, c$ que devolverá cifrados al servidor de SEAL.

$ DIAGRAMA PARA SUBIR DATOS DE SEAL A TFHE$

\subsection{Curva de regresión}

Esta curva está definida por tres parámetros (a, b y c):

$ ax^2 + bx + c $

Para calcularla estos parámetros, es necesario realizar las siguientes operaciones con los datos de temperatura:

$ OPERACIONES PARA a, b y c $

TFHE sólo ofrece operadores lógicos, así que tenemos que escribir la operaciones aritméticas necesarias: suma, resta, multiplicación y división. Además tendremos que dar la posibilidad de trabajar con números reales, por lo que tendremos que determinar la codificación más apropiada.

\subsection{tfhe-math}

$ OPERACIONES DE FUNCTIONS.h $

He hecho las siguientes operaciones aritméticas:

- Suma


\section{Implementación con SEAL}
